<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Buffalo-Style Slot Game with Sound Toggle</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 0;
  }
  #slot-container {
    margin: 20px auto;
    width: 520px;
    background: #222;
    border-radius: 15px;
    box-shadow: 0 0 20px #0f0;
    padding: 15px;
  }
  #reels {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    font-size: 60px;
    user-select: none;
  }
  .cell {
    background: #000;
    border-radius: 8px;
    padding: 15px 0;
    box-shadow: inset 0 0 10px #060;
    transition: background 0.3s ease;
  }
  .highlight {
    background: #060;
    box-shadow: 0 0 10px #0f0;
  }
  #controls {
    margin-top: 20px;
  }
  button {
    font-size: 20px;
    padding: 12px 20px;
    margin: 0 10px 10px 10px;
    border-radius: 10px;
    border: none;
    background: #0a0;
    color: #efe;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #0f0;
  }
  #info {
    margin-top: 15px;
    font-size: 20px;
  }
  #message {
    margin-top: 15px;
    font-size: 22px;
    min-height: 28px;
  }
</style>
</head>
<body>

<h1>Buffalo-Style Slot Game with Sound Toggle</h1>
<div id="slot-container">
  <div id="reels"></div>
  <div id="controls">
    <button id="spinBtn">Spin</button>
    <button id="betDownBtn">- Bet</button>
    <button id="betUpBtn">+ Bet</button>
    <button id="soundToggleBtn">Sound: ON</button>
  </div>
  <div id="info">
    Credits: <span id="credits">1000</span> | Bet: <span id="bet">10</span> | Win: <span id="win">0</span>
  </div>
  <div id="message"></div>
</div>

<!-- SOUND FILES -->
<audio id="sound-spin" src="https://freesound.org/data/previews/341/341695_6245708-lq.mp3" preload="auto"></audio>
<audio id="sound-reel-stop" src="https://freesound.org/data/previews/41/41544_512123-lq.mp3" preload="auto"></audio>
<audio id="sound-win" src="https://freesound.org/data/previews/320/320655_5260875-lq.mp3" preload="auto"></audio>

<script>
const SYMBOLS = [
  { symbol: 'ü¶¨', weight: 20 },
  { symbol: 'üêÖ', weight: 25 },
  { symbol: 'ü¶Ö', weight: 30 },
  { symbol: 'ü¶å', weight: 50 },
  { symbol: 'üçÄ', weight: 70 },
  { symbol: 'üçé', weight: 80 },
  { symbol: 'üîî', weight: 90 },
  { symbol: '‚≠ê', weight: 100 }
];

const REELS_COUNT = 5;
const ROWS_COUNT = 3;

const PAYLINES = [
  [1,1,1,1,1],
  [0,0,0,0,0],
  [2,2,2,2,2],
  [0,1,2,1,0],
  [2,1,0,1,2],
  [0,0,1,0,0],
  [2,2,1,2,2],
  [1,0,0,0,1],
  [1,2,2,2,1],
  [0,1,1,1,2]
];

const PAYOUTS = {
  'ü¶¨': [50, 200, 1000],
  'üêÖ': [30, 150, 750],
  'ü¶Ö': [20, 100, 500],
  'ü¶å': [15, 75, 250],
  'üçÄ': [10, 50, 200],
  'üçé': [8, 40, 150],
  'üîî': [5, 25, 100],
  '‚≠ê': [2, 10, 50]
};

let credits = 1000;
let bet = 10;
let win = 0;

let soundEnabled = true;

const reelsEl = document.getElementById('reels');
const creditsEl = document.getElementById('credits');
const betEl = document.getElementById('bet');
const winEl = document.getElementById('win');
const spinBtn = document.getElementById('spinBtn');
const betUpBtn = document.getElementById('betUpBtn');
const betDownBtn = document.getElementById('betDownBtn');
const messageEl = document.getElementById('message');
const soundToggleBtn = document.getElementById('soundToggleBtn');

const soundSpin = document.getElementById('sound-spin');
const soundReelStop = document.getElementById('sound-reel-stop');
const soundWin = document.getElementById('sound-win');

function createGrid() {
  reelsEl.innerHTML = '';
  for(let i=0; i < REELS_COUNT * ROWS_COUNT; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.textContent = '‚ùî';
    reelsEl.appendChild(cell);
  }
}

function weightedRandomSymbol() {
  let totalWeight = SYMBOLS.reduce((sum, s) => sum + s.weight, 0);
  let rand = Math.random() * totalWeight;
  for(let i = 0; i < SYMBOLS.length; i++) {
    if(rand < SYMBOLS[i].weight) return SYMBOLS[i].symbol;
    rand -= SYMBOLS[i].weight;
  }
  return SYMBOLS[SYMBOLS.length-1].symbol;
}

function generateSpinResult() {
  const result = [];
  for(let r=0; r < REELS_COUNT; r++) {
    const reelSymbols = [];
    for(let row=0; row < ROWS_COUNT; row++) {
      reelSymbols.push(weightedRandomSymbol());
    }
    result.push(reelSymbols);
  }
  return result;
}

function displayReels(result) {
  for(let r=0; r < REELS_COUNT; r++) {
    for(let row=0; row < ROWS_COUNT; row++) {
      const cellIndex = r * ROWS_COUNT + row;
      const cell = reelsEl.children[cellIndex];
      cell.textContent = result[r][row];
      cell.classList.remove('highlight');
    }
  }
}

function matchSymbolsOnPayline(result, payline) {
  let firstSymbol = result[0][payline[0]];
  if(firstSymbol === 'üçÄ') {
    for(let r=1; r<REELS_COUNT; r++) {
      if(result[r][payline[r]] !== 'üçÄ') {
        firstSymbol = result[r][payline[r]];
        break;
      }
    }
  }
  if(!firstSymbol) return 0;

  let matchCount = 0;
  for(let r=0; r<REELS_COUNT; r++) {
    const symbol = result[r][payline[r]];
    if(symbol === firstSymbol || symbol === 'üçÄ') {
      matchCount++;
    } else {
      break;
    }
  }
  return matchCount;
}

function calculateWin(result) {
  let totalWin = 0;
  let winningLines = [];

  for(let i=0; i < PAYLINES.length; i++) {
    const payline = PAYLINES[i];
    const matches = matchSymbolsOnPayline(result, payline);
    if(matches >= 3) {
      let baseSymbol = result[0][payline[0]];
      if(baseSymbol === 'üçÄ') {
        for(let r=1; r<REELS_COUNT; r++) {
          if(result[r][payline[r]] !== 'üçÄ') {
            baseSymbol = result[r][payline[r]];
            break;
          }
        }
      }
      if(baseSymbol && PAYOUTS[baseSymbol]) {
        const lineWin = PAYOUTS[baseSymbol][matches - 3] * bet;
        totalWin += lineWin;
        winningLines.push({lineIndex: i, symbols: baseSymbol, count: matches, lineWin});
      }
    }
  }
  return {totalWin, winningLines};
}

function highlightWinningLines(result, winningLines) {
  for(let cell of reelsEl.children) {
    cell.classList.remove('highlight');
  }
  for(let winLine of winningLines) {
    const payline = PAYLINES[winLine.lineIndex];
    for(let r=0; r<winLine.count; r++) {
      const row = payline[r];
      const cellIndex = r * ROWS_COUNT + row;
      reelsEl.children[cellIndex].classList.add('highlight');
    }
  }
}

async function animateSpin(finalResult) {
  const intervalTime = 50;
  const spinsPerReel = 20;

  for(let reelIndex = 0; reelIndex < REELS_COUNT; reelIndex++) {
    for(let spinCount = 0; spinCount < spinsPerReel; spinCount++) {
      const spinningResult = [];

      for(let r = 0; r < REELS_COUNT; r++) {
        const col = [];
        if(r <= reelIndex) {
          col.push(...finalResult[r]);
        } else {
          for(let row=0; row < ROWS_COUNT; row++) {
            col.push(weightedRandomSymbol());
          }
        }
        spinningResult.push(col);
      }

      displayReels(spinningResult);
      await new Promise(r => setTimeout(r, intervalTime));
    }
    playSound(soundReelStop);
  }
}

function playSound(soundElement) {
  if(soundEnabled) {
    soundElement.currentTime = 0;
    soundElement.play();
  }
}

function updateUI() {
  creditsEl.textContent = credits;
  betEl.textContent = bet;
  winEl.textContent = win;
}

async function spin() {
  if(bet > credits) {
    messageEl.textContent = 'Not enough credits to bet!';
    return;
  }
  spinBtn.disabled = true;
  betUpBtn.disabled = true;
  betDownBtn.disabled = true;
  messageEl.textContent = '';
  win = 0;
  updateUI();

  credits -= bet;
  updateUI();

  playSound(soundSpin);

  const finalResult = generateSpinResult();

  await animateSpin(finalResult);

  const {totalWin, winningLines} = calculateWin(finalResult);
  win = totalWin;
  credits += win;
  updateUI();

  if(win > 0) {
    playSound(soundWin);
    messageEl.textContent = `üéâ You won ${win} credits!`;
    highlightWinningLines(finalResult, winningLines);
  } else {
    messageEl.textContent = 'Try again!';
  }

  spinBtn.disabled = false;
  betUpBtn.disabled = false;
  betDownBtn.disabled = false;
}

spinBtn.addEventListener('click', spin);

betUpBtn.addEventListener('click', () => {
  if(bet + 10 <= credits) {
    bet += 10;
    updateUI();
  }
});
betDownBtn.addEventListener('click', () => {
  if(bet - 10 >= 10) {
    bet -= 10;
    updateUI();
  }
});

soundToggleBtn.addEventListener('click', () => {
  soundEnabled = !soundEnabled;
  soundToggleBtn.textContent = soundEnabled ? 'Sound: ON' : 'Sound: OFF';
});

createGrid();
updateUI();
</script>

</body>
</html>
